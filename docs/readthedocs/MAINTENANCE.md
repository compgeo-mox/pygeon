# Documentation Maintenance Guide

This page describes how to keep the PyGeoN documentation healthy, consistent, and warning‑free—both locally and on ReadTheDocs (RTD).

## Daily checklist

- Write/maintain docstrings (Google or NumPy style) with type hints
- Prefer MyST Markdown for equations: use fenced blocks with ` ```{math} ... ``` `
- Run a strict local build before pushing:
  ```bash
  cd docs
  make strict
  ```
- Fix any warnings reported (missing refs, bad RST/Md, imports, etc.)
- Commit and push — CI and RTD will rebuild automatically

## Local builds

- Regular build (tolerates warnings):
  ```bash
  cd docs
  make html
  ```
- Strict build (same flags as CI):
  ```bash
  cd docs
  make strict
  # or
  ./readthedocs/build_strict.sh
  ```

## Automatic content

- API reference: auto‑generated by `sphinx-apidoc` on every build
- Reports: any `*.md` in `docs/reports_src/` are copied to `docs/reports/` before Sphinx runs
- RTD pre‑build also runs this step so online docs match local builds

## Adding a new module

1. Implement code under `src/pygeon/...` with good docstrings
2. Build docs locally (`make html`); the API page is generated automatically
3. If you want a curated page, add an `.rst` file under `docs/api/` and link it in an appropriate toctree

## Adding a new report

1. Place your Markdown source in `docs/reports_src/`
2. (Optional) Add a generator at `docs/reports_src/generate_reports.sh` and make it executable:
   ```bash
   chmod +x docs/reports_src/generate_reports.sh
   ```
3. Build docs; the report appears under the "Reports" section

## Common issues and fixes

- Math blocks show as code with warnings like "Pygments lexer name 'math'":
  - Use ` ```{math} ... ``` ` blocks (MyST), not ` ```math`
- Broken references (e.g., `:class:` or `:ref:`):
  - Ensure targets exist or correct the path/label; use fully‑qualified import paths
- Import errors on RTD (heavy/GUI libs):
  - `docs/conf.py` mocks VTK/mesh IO libs and RTD installs minimal X/OpenGL libs via `.readthedocs.yaml`

## Folder layout (docs)

- `conf.py` — Sphinx configuration
- `index.rst` — main entry
- `api/` — curated API pages and apidoc output
- `reports_src/` — user‑maintained reports (Markdown) — versioned
- `reports/` — generated copies used by Sphinx — ignored by git
- `readthedocs/` — RTD/CI helpers and contributor docs
  - `hooks/pre_build_reports.sh` — copies reports into place
  - `build_strict.sh` — strict local build wrapper
  - `generate_api_docs.sh` — apidoc helper (optional)
  - `CI_REFERENCE.md`, `QUALITY_ASSURANCE.md`, `QUICKSTART_CI.md`, `AUTO_GENERATION.md` — contributor docs

## CI & RTD

- GitHub Actions: `.github/workflows/docs.yml` runs strict Sphinx build on push/PR
- ReadTheDocs: `.readthedocs.yaml` sets Python, installs deps, runs report hook and apidoc, builds Sphinx
- Fail on warnings in CI keeps docs clean; RTD may be configured looser during transition

## Tips

- Keep prose in Markdown where convenient—MyST supports directives/roles
- For long API pages, prefer explicit `.rst` with `automodule` + `:members:` to control ordering
- When deprecating modules, keep stubs with clear messages until downstream docs are updated
